<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="robots" content="noindex,nofollow">
    <title>Robloxクイックコピー(ぼっちん)</title>
    <link rel="icon" href="https://i-navit.github.io/request/favicon.ico" type="image/x-icon">
    <style>
        body {
            font-family: sans-serif;
            padding: 5px 20px;
            text-align: left;
            background-color: #fff;
            color: #333333;
            /* PC表示でのベースの文字サイズ */
            font-size: 14px;
        }

        .container {
            width: 100%;
            margin-bottom: 15px;
        }

        .copyTarget {
            padding: 8px 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            background-color: #f9f9f9;
            width: 100%;
            box-sizing: border-box;
            text-align: left;
            cursor: pointer;
            transition: background-color 0.2s ease-in-out;
            word-wrap: break-word;
        }

        .copyTarget.clicked {
            /* コピー時に背景色が変わるクラス */
            background-color: #ffff00;
        }

        .customkey_ttl {
            background: #7bbdf7;
            color: #fff;
            font-weight: bold;
            padding: 0.5em 1em 0.2em;
            display: inline-block;
            margin-bottom: 0;
            border-radius: 5px 5px 0 0;
        }

        .custom_txt {
            border-radius: 0 5px 5px 5px;
            background: #e0f8ff;
            padding: 1em;
        }

        #customkey-input {
            width: 100%;
            max-width: 800px;
            padding: 8px;
            box-sizing: border-box;
            font-size: 1em;
            /* ★ボタンと横並びにする★ */
            display: inline-block;
            /* ★ボタンと中央揃えにする★ */
            vertical-align: middle;
        }

        /* ★★★ プレースホルダーのテキスト色を#D4D4D4に変更 ★★★ */
        #customkey-input::placeholder {
            color: #D4D4D4;
            opacity: 1;
        }

        #customkey-input::-webkit-input-placeholder {
            color: #D4D4D4;
        }

        #customkey-input::-moz-placeholder {
            color: #D4D4D4;
            opacity: 1;
        }

        #customkey-input:-ms-input-placeholder {
            color: #D4D4D4;
        }

        /* 1文字消すボタンのスタイル */
        #delete-last-char-button,
        #delete-all-char-button {
            margin-left: 5px;
            width: 35px;
            height: 28px;
            line-height: 28px;
            padding: 0;
            text-align: center;
            font-size: 0.8em;
            vertical-align: middle;
            border: 1px solid #a0d4ff;
            border-radius: 5px;
            background-color: #e5f6ff;
            cursor: pointer;
        }

        #delete-last-char-button:hover,
        #delete-all-char-button:hover {
            background-color: #a0deff;
        }

        .ColorTxt {
            color: #00A313;
            /* ★span class="ColorTxt"で文字色を変えられる★ */
        }

        /* ★★★ スマホ表示用のスタイルを追加 ★★★ */
        @media screen and (max-width: 768px) {
            body {
                /* 全体の文字サイズをスマホ向けに調整 */
                font-size: 13px;
                /* 左右の余白を少し狭くする */
                padding: 5px 15px;
                /* テキストが長くなった時に、変なところで改行されるのを防ぐ */
                -webkit-text-size-adjust: 100%;
            }

            .copyTarget {
                /* ボタン内の文字サイズを調整 (bodyに合わせる) */
                font-size: 1em;
                /* 上下の余白を少し広げてタップしやすくする */
                padding: 8px 12px;
            }

            .customkey_ttl {
                /* タイトルの文字サイズを調整 */
                font-size: 0.9em;
            }

            /* スマホでのボタンと入力欄の調整 */
            #customkey-input {
                /* ボタンが2つになっても幅に収まるように調整 */
                max-width: calc(100% - 130px);
            }

            #delete-last-char-button,
            #delete-all-char-button {
                font-size: 0.7em;
                padding: 0;
                width: 30px;
                height: 24px;
                line-height: 24px;
            }
        }
    </style>
</head>

<body>

    <div class="customkey_ttl">Roblox 自由テキストエリア</div>
    <div class="custom_txt">
        <input type="text" id="customkey-input" placeholder="好きな文章を書いてね">
        <button id="delete-last-char-button">◀</button>
        <button id="delete-all-char-button">All</button> <!-- 全消去ボタン -->
        <div class="container" style="margin-top:10px;">
            <p class="copyTarget" id="customkey-output"></p>
        </div>
    </div>

    <div id="spreadsheet-data-container">
        <p>読み込み中...</p>
    </div>

    <script>
        // ★★★【要設定】GASのウェブアプリURLを貼り付ける ★★★
        // スプレッドシートからの読み込みを継続します
        const GAS_WEB_APP_URL = 'https://script.google.com/macros/s/AKfycbwMpUut950ecJDWNeJDhzw0YDJtdRYu0kANRUzVDf3yFD9_surX3gT1tFNjxdnqqtkb3Q/exec';

        document.addEventListener('DOMContentLoaded', () => {
            const customKeyInput = document.getElementById('customkey-input');
            const customKeyOutput = document.getElementById('customkey-output');
            const dataContainer = document.getElementById('spreadsheet-data-container');
            const deleteButton = document.getElementById('delete-last-char-button');
            const deleteAllButton = document.getElementById('delete-all-char-button');

            // ★カスタムキーテンプレートを「★」に固定
            let customKeyTemplate = '★';

            // ★★★ 読み込み開始前にカスタムキーエリアを初期化する ★★★
            // これで、GASの読み込み中も「★」が表示された状態になる
            updateCustomKeyOutput();

            // カスタムキーの入力にリアルタイムで反応する処理
            customKeyInput.addEventListener('input', updateCustomKeyOutput);

            function updateCustomKeyOutput() {
                const inputValue = customKeyInput.value;

                // 入力値が空の場合は、テンプレート文字（★）をそのまま表示
                if (inputValue === '') {
                    customKeyOutput.innerHTML = customKeyTemplate; // ★を表示
                } else {
                    // テンプレートの '★' を入力値で置き換える
                    customKeyOutput.innerHTML = customKeyTemplate.replace('★', inputValue);
                }
            }

            // 1文字消すボタンのクリックイベント
            deleteButton.addEventListener('click', () => {
                let currentValue = customKeyInput.value;
                if (currentValue.length > 0) {
                    customKeyInput.value = currentValue.slice(0, -1); // 最後の1文字を削除
                    updateCustomKeyOutput(); // 表示も更新
                }
                // フォーカスを戻して続けて入力できるようにする
                customKeyInput.focus();
            });

            // 全消去ボタンのクリックイベント
            deleteAllButton.addEventListener('click', () => {
                customKeyInput.value = ''; // 入力値を空にする
                updateCustomKeyOutput();   // 表示を更新（★に戻る）
                customKeyInput.focus();    // フォーカスを戻す
            });

            // Googleスプレッドシートからデータを読み込む処理（定型文のみ取得）
            fetch(GAS_WEB_APP_URL)
                .then(response => {
                    if (!response.ok) {
                        // ネットワークエラーまたはGAS側でのエラー(例: 404, 500)
                        throw new Error('ネットワークの応答がありませんでした。');
                    }
                    return response.json();
                })
                .then(data => {
                    if (data.error) {
                        // GASのスクリプト内で定義されたエラー
                        throw new Error(data.error);
                    }

                    dataContainer.innerHTML = ''; // 「読み込み中...」を消去


                    // 定型文をHTMLに描画
                    if (data.phrases && data.phrases.length > 0) {
                        data.phrases.forEach(phrase => {
                            const div = document.createElement('div');
                            div.className = 'container';

                            const pCopy = document.createElement('p');
                            pCopy.className = 'copyTarget';
                            pCopy.innerHTML = phrase; // HTMLを解釈するためinnerHTMLを使用

                            div.appendChild(pCopy);
                            dataContainer.appendChild(div);
                        });
                    } else {
                        dataContainer.innerHTML = '<p>登録されている定型文はありません。</p>';
                    }
                })
                .catch(error => {
                    console.error('Fetch Error:', error);
                    dataContainer.innerHTML = `<p style="color:red;">データの読み込みに失敗しました: ${error.message}</p>`;
                });
        });

        // コピークリックイベントのセットアップ（イベント委任）
        document.body.addEventListener('click', function (event) {
            if (event.target && event.target.classList.contains('copyTarget')) {
                const targetElement = event.target;
                // テキストが空の場合はコピーしない
                if (!targetElement.innerText.trim()) {
                    return;
                }

                // textContentではなく、innerHTMLから取得したテキストを使う
                const tempDiv = document.createElement('div');
                tempDiv.innerHTML = targetElement.innerHTML;
                // HTMLタグ（<span class="ColorTxt">）を除去したテキスト内容を取得
                const textToCopy = tempDiv.textContent || tempDiv.innerText;

                // クリック時にクラスを追加して背景色を変える
                targetElement.classList.add('clicked');

                // navigator.clipboard.writeText() は iframe 内で動かない場合があるため、
                // execCommand('copy') のフォールバックロジックも検討するが、
                // 現状は canvas 環境の制約により navigator.clipboard.writeText() を使用

                navigator.clipboard.writeText(textToCopy)
                    .then(() => {
                        // コピー成功。1秒後にクラスを削除して背景色を元に戻す
                        setTimeout(() => {
                            targetElement.classList.remove('clicked');
                        }, 1000);
                    })
                    .catch(err => {
                        console.error('クリップボードへの書き込みに失敗しました:', err);
                        // コピー失敗。2秒後にクラスを削除して背景色を元に戻す
                        setTimeout(() => {
                            targetElement.classList.remove('clicked');
                        }, 2000);
                    });
            }
        });
    </script>

</body>

</html>