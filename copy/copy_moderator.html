<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="robots" content="noindex,nofollow">
<title>定型文クイックコピー(モデレーター用)</title>
<link rel="icon" href="https://i-navit.github.io/request/favicon.ico" type="image/x-icon">
<style>
  body {
    font-family: sans-serif;
    padding: 5px 20px;
    text-align: left;
    background-color: #fff;
    color: #333333;
    /* PC表示でのベースの文字サイズ */
    font-size: 14px;
  }
  .container {
    width: 100%;
    margin-bottom: 15px;
  }
  .copyTarget {
    padding: 8px 10px;
    border: 1px solid #ccc;
    border-radius: 5px;
    background-color: #f9f9f9;
    width: 100%;
    box-sizing: border-box;
    text-align: left;
    cursor: pointer;
    transition: background-color 0.2s ease-in-out; 
    word-wrap: break-word;
  }
  .copyTarget.clicked { /* クリック時の背景色 */
    background-color: #ffff99;
  }
  .message {
    display: none;
    margin-top: 5px;
    color: #ff0099;
    font-weight: bold;
  }
  .ColorTxt {
  color: #00A313; /* ★span class="ColorTxt"で文字色を変えられる★ */
  }

  /* スマホ表示用のスタイル */
  @media screen and (max-width: 768px) {
    body {
      font-size: 13px;
      padding: 5px 15px;
      -webkit-text-size-adjust: 100%;
    }

    .copyTarget {
      font-size: 1em;
      padding: 8px 12px;
    }
  }

</style>
</head>
<body>


<div id="spreadsheet-data-container">
  <p>読み込み中...</p>
</div>

<script>
// ★★★【要設定】GASのウェブアプリURLを貼り付ける ★★★
const GAS_WEB_APP_URL = 'https://script.google.com/macros/s/AKfycbwscFNQe_s4FD12OgcKez3Qsml6PBiLScSotkrI7Dtefi8lYzVCJlYgMK71V3tE6DNLew/exec';

document.addEventListener('DOMContentLoaded', () => {
  const dataContainer = document.getElementById('spreadsheet-data-container');

  // ① Googleスプレッドシートからデータを読み込む処理
  fetch(GAS_WEB_APP_URL)
    .then(response => {
      if (!response.ok) {
        throw new Error('ネットワークの応答がありませんでした。');
      }
      return response.json();
    })
    .then(data => {
      if (data.error) {
        throw new Error(data.error);
      }
      
      dataContainer.innerHTML = ''; // 「読み込み中...」を消去

      // 定型文をHTMLに描画
      if (data.phrases && data.phrases.length > 0) {
        data.phrases.forEach(phrase => {
          const div = document.createElement('div');
          div.className = 'container';

          const pCopy = document.createElement('p');
          pCopy.className = 'copyTarget';
          pCopy.innerHTML = phrase; // 定型文をセット

          const pMessage = document.createElement('p');
          pMessage.className = 'message';
          pMessage.innerText = 'コピー完了！';

          div.appendChild(pCopy);
          div.appendChild(pMessage);
          dataContainer.appendChild(div);
        });
      } else {
        dataContainer.innerHTML = '<p>登録されている定型文はありません。</p>';
      }
    })
    .catch(error => {
      console.error('Fetch Error:', error);
      dataContainer.innerHTML = `<p style="color:red;">データの読み込みに失敗しました: ${error.message}</p>`;
    });
});

// ② コピークリックイベントのセットアップ（イベント委任）
document.body.addEventListener('click', function(event) {
  if (event.target && event.target.classList.contains('copyTarget')) {
    const targetElement = event.target;
    // テキストが空の場合はコピーしない
    if (!targetElement.innerText.trim()) {
      return;
    }

    const textToCopy = targetElement.innerText;
    const messageElement = targetElement.nextElementSibling;  

    if (!messageElement || !messageElement.classList.contains('message')) {
      console.error('対応するメッセージ要素が見つかりません。');
      return;
    }

    // クリック時にクラスを追加して背景色を変える
    targetElement.classList.add('clicked'); 

    // クリップボードAPIを使用してコピー
    navigator.clipboard.writeText(textToCopy)
      .then(() => {
        messageElement.style.display = "block";
        setTimeout(() => {
          messageElement.style.display = "none";
          // メッセージ表示後にクラスを削除して背景色を元に戻す
          targetElement.classList.remove('clicked'); 
        }, 1200);
      })
      .catch(err => {
        console.error('クリップボードへの書き込みに失敗しました:', err);
        messageElement.textContent = "コピーに失敗しました。";
        messageElement.style.color = "red";
        messageElement.style.display = "block";
        setTimeout(() => {
          messageElement.style.display = "none";
          messageElement.textContent = "コピー完了！";
          messageElement.style.color = "#ff0099"; // 元の色に戻す
          // エラー時にもクラスを削除して背景色を元に戻す
          targetElement.classList.remove('clicked'); 
        }, 3000);
      });
  }
});
</script>

</body>
</html>
