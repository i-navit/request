<!DOCTYPE html>
<html>
<head>
<title>å®šå‹æ–‡ãƒ¯ãƒ³ã‚¯ãƒªãƒƒã‚¯ã‚³ãƒ”ãƒ¼ï¼ˆã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆé€£æºç‰ˆï¼‰</title>
<style>
  body {
    font-family: sans-serif;
    padding: 5px 20px;
    text-align: left;
    background-color: #fff;
    color: #3e3e3e;
  }

  .container {
    width: 100%;
    margin-bottom: 15px;
  }

  .copyTarget {
    padding: 5px 10px;
    border: 1px solid #ccc;
    border-radius: 5px;
    background-color: #f9f9f9;
    width: 100%;
    box-sizing: border-box;
    text-align: left;
    cursor: pointer;
    transition: background-color 0.2s ease-in-out;
  }

  .copyTarget:hover {
    background-color: yellow;
  }

  .message {
    display: none;
    margin-top: 5px;
    color: #ff0099;
  }

  .white{
    color: #fff;
  }
  .red{
    color: #ff0000;
  }

.customkey_ttl {
	background: #a78acb;
	color: #fff;
	font-weight: bold;
	padding: 0.5em 1em 0.2em;
	display: inline-block;
	margin-bottom: 0;
	border-radius: 5px 5px 0 0;
	}
.customkey_box {
	border-radius: 0 5px 5px 5px;
	background: #e0e0ff;
	padding: 1em;
	}
</style>
</head>
<body>

<div class="customkey_ttl">ã‚«ã‚¹ã‚¿ãƒ ã‚­ãƒ¼ã‚’å…¥åŠ›ã—ã¦ã­</div>
<div class="customkey_box">
<input type="text" id="customKeyInput" name="customkey" onkeyup="updateCustomKey()">
<div class="container">
  <p class="copyTarget" id="customKeyCopyTarget">ã‚«ã‚¹ã‚¿ãƒ ã‚­ãƒ¼ğŸ”‘â˜…</p>
  <p class="message">ã‚³ãƒ”ãƒ¼å®Œäº†ï¼</p>
</div>
</div>

<div id="spreadsheetTexts">
  </div>

<script>
// â‘ ã‚«ã‚¹ã‚¿ãƒ ã‚­ãƒ¼ã®å³æ™‚åæ˜ ã¨ä¿å­˜
const customKeyInput = document.getElementById('customKeyInput');
const customKeyCopyTarget = document.getElementById('customKeyCopyTarget');

function updateCustomKey() {
  const customKeyValue = customKeyInput.value;
  customKeyCopyTarget.innerText = `ã‚«ã‚¹ã‚¿ãƒ ã‚­ãƒ¼ğŸ”‘${customKeyValue}â˜…`;
}

// ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«ã‚«ã‚¹ã‚¿ãƒ ã‚­ãƒ¼ã‚’ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã‹ã‚‰å–å¾—ã—ã¦åæ˜ 
google.script.run.withSuccessHandler(function(customKey) {
  if (customKey) {
    customKeyInput.value = customKey;
    updateCustomKey();
  }
}).getCustomKey();


// â‘¡ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã‹ã‚‰æ–‡ç« ã‚’èª­ã¿è¾¼ã‚“ã§è¡¨ç¤º
google.script.run.withSuccessHandler(function(data) {
  const spreadsheetTextsDiv = document.getElementById('spreadsheetTexts');
  data.forEach(function(text) {
    if (text) { // ç©ºã®ã‚»ãƒ«ã¯è¡¨ç¤ºã—ãªã„
      const containerDiv = document.createElement('div');
      containerDiv.className = 'container';

      const pCopyTarget = document.createElement('p');
      pCopyTarget.className = 'copyTarget';
      pCopyTarget.innerText = text;

      const pMessage = document.createElement('p');
      pMessage.className = 'message';
      pMessage.innerText = 'ã‚³ãƒ”ãƒ¼å®Œäº†ï¼';

      containerDiv.appendChild(pCopyTarget);
      containerDiv.appendChild(pMessage);
      spreadsheetTextsDiv.appendChild(containerDiv);
    }
  });
  // DOMContentLoadedã®ä»£ã‚ã‚Šã«ã“ã“ã§ã‚³ãƒ”ãƒ¼æ©Ÿèƒ½ã‚’å†è¨­å®š
  setupCopyFunctionality();
}).getSpreadsheetData();

// ã‚³ãƒ”ãƒ¼æ©Ÿèƒ½ã®æ±ç”¨åŒ–
function setupCopyFunctionality() {
  const copyTargets = document.querySelectorAll('.copyTarget');
  const messages = document.querySelectorAll('.message');

  copyTargets.forEach((target, index) => {
    target.addEventListener('click', function() {
      const textToCopy = this.innerText;
      const messageElement = messages[index]; // å¯¾å¿œã™ã‚‹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¦ç´ ã‚’å–å¾—

      // ã‚«ã‚¹ã‚¿ãƒ ã‚­ãƒ¼ã®å ´åˆã€ã‚«ã‚¹ã‚¿ãƒ ã‚­ãƒ¼ã ã‘ã‚’ã‚³ãƒ”ãƒ¼ã™ã‚‹ã‚ˆã†ã«èª¿æ•´
      if (this.id === 'customKeyCopyTarget') {
        const customKeyValue = customKeyInput.value;
        navigator.clipboard.writeText(customKeyValue)
          .then(() => {
            messageElement.style.display = "block";
            setTimeout(function() {
              messageElement.style.display = "none";
            }, 1000);
            // ã‚«ã‚¹ã‚¿ãƒ ã‚­ãƒ¼ã‚’ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã«ä¿å­˜
            google.script.run.saveCustomKey(customKeyValue);
          })
          .catch(err => {
            console.error('ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã¸ã®æ›¸ãè¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ:', err);
            messageElement.textContent = "ã‚³ãƒ”ãƒ¼ã«å¤±æ•—ã—ã¾ã—ãŸã€‚";
            messageElement.style.color = "red";
            messageElement.style.display = "block";
            setTimeout(function() {
              messageElement.style.display = "none";
              messageElement.textContent = "ã‚³ãƒ”ãƒ¼å®Œäº†ï¼";
              messageElement.style.color = "#ff0099"; // å…ƒã®è‰²ã«æˆ»ã™
            }, 3000);
          });
      } else {
        // ãã‚Œä»¥å¤–ã®å®šå‹æ–‡
        navigator.clipboard.writeText(textToCopy)
          .then(() => {
            messageElement.style.display = "block";
            setTimeout(function() {
              messageElement.style.display = "none";
            }, 1000);
          })
          .catch(err => {
            console.error('ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã¸ã®æ›¸ãè¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ:', err);
            messageElement.textContent = "ã‚³ãƒ”ãƒ¼ã«å¤±æ•—ã—ã¾ã—ãŸã€‚";
            messageElement.style.color = "red";
            messageElement.style.display = "block";
            setTimeout(function() {
              messageElement.style.display = "none";
              messageElement.textContent = "ã‚³ãƒ”ãƒ¼å®Œäº†ï¼";
              messageElement.style.color = "#ff0099"; // å…ƒã®è‰²ã«æˆ»ã™
            }, 3000);
          });
      }
    });
  });
}

// åˆæœŸãƒ­ãƒ¼ãƒ‰æ™‚ã«ã‚‚ã‚³ãƒ”ãƒ¼æ©Ÿèƒ½ã‚’æœ‰åŠ¹ã«ã™ã‚‹
// DOMContentLoadedã§å®Ÿè¡Œã™ã‚‹ã¨ã€GASã‹ã‚‰ã®ãƒ‡ãƒ¼ã‚¿å–å¾—å‰ã«å®Ÿè¡Œã•ã‚Œã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ãŸã‚ã€
// `getSpreadsheetData()` ã® `withSuccessHandler` å†…ã§ `setupCopyFunctionality()` ã‚’å‘¼ã³å‡ºã™ã‚ˆã†ã«å¤‰æ›´ã€‚

</script>

</body>
</html>
