<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>参加フォーム</title>
    <style>
        /* (以前のスタイルと同じ) */
    </style>
</head>
<body>
    <h1>参加フォーム</h1>
    <div class="form-container">
        <p id="error-message" class="error"></p>
        <div class="checkbox-group">
            <div class="checkbox-item">
                <input type="checkbox" id="check1" name="check1" required>
                <label for="check1"><ruby>概要<rt>がいよう</rt></ruby><ruby>欄<rt>らん</rt></ruby>の<ruby>参加<rt>さんか</rt></ruby><ruby>方法<rt>ほうほう</rt></ruby>は<ruby>読<rt>よ</rt></ruby>みましたか？<span class="required-mark" style="color: red;">※</span></label>
            </div>
            <div class="checkbox-item">
                <input type="checkbox" id="check2" name="check2" required>
                <label for="check2"><ruby>セキュリティ<rt>せきゅりてぃ</rt></ruby><ruby>強化<rt>きょうか</rt></ruby>のため、<ruby>初<rt>はじ</rt></ruby>めて<ruby>参加<rt>さんか</rt></ruby>される<ruby>方<rt>かた</rt></ruby>は、<ruby>一時的<rt>いちじてき</rt></ruby>なフレンドとして<ruby>配信<rt>はいしん</rt></ruby><ruby>後<rt>ご</rt></ruby>フレンド<ruby>整理<rt>せいり</rt></ruby>、<ruby>削除<rt>さくじょ</rt></ruby>させていただく<ruby>場合<rt>ばあい</rt></ruby>があります。<span class="required-mark" style="color: red;">※</span></label>
            </div>
        </div>
        <div class="form-group">
            <label for="id">IDを<ruby>書<rt>か</rt></ruby>いてください<span class="required-mark" style="color: red;">※</span>：</label>
            <input type="text" id="id" name="id" required>
        </div>
        <div class="form-group">
            <label for="nickname">ニックネームを<ruby>書<rt>か</rt></ruby>いてください：</label>
            <input type="text" id="nickname" name="nickname">
        </div>
        <div class="button-container">
            <button onclick="submitForm()">送信</button>
            <button onclick="window.close()">閉じる</button>
        </div>
        <p id="submission-message" style="display:none;"></p>
    </div>
    <script>
        const scriptURL = 'https://script.google.com/macros/s/AKfycbw9Nnilq6Hv3zT3Smz44REXni4NakbrsYo4cNxRRd_pwJOq2baBxMXqNnXedW3cM9Ha/exec';
        const errorMessageElement = document.getElementById('error-message');
        const submissionMessageElement = document.getElementById('submission-message');
        const formContainer = document.querySelector('.form-container');
        const buttonContainer = document.querySelector('.button-container');

        function submitForm() {
            const check1 = document.getElementById('check1');
            const check2 = document.getElementById('check2');
            const idInput = document.getElementById('id');

            if (!check1.checked || !check2.checked || idInput.value.trim() === '') {
                errorMessageElement.textContent = '※マークはぜんぶ入力してね';
                submissionMessageElement.style.display = 'none';
                return;
            }

            errorMessageElement.textContent = '';

            const formData = new FormData();
            formData.append('id', idInput.value);
            formData.append('nickname', document.getElementById('nickname').value);

            fetch(scriptURL, {
                method: 'POST',
                body: formData,
                mode: 'no-cors'
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                return response.json();
            })
            .then(data => {
                if (data && data.message) {
                    submissionMessageElement.textContent = data.message;
                    submissionMessageElement.style.display = 'block';
                    formContainer.style.display = 'none';
                    buttonContainer.style.display = 'none';
                } else {
                    console.error('Error: Received unexpected data:', data);
                    errorMessageElement.textContent = '送信結果の表示に失敗しました。';
                    submissionMessageElement.style.display = 'none';
                }
            })
            .catch(error => {
                console.error('Fetch error:', error);
                errorMessageElement.textContent = '送信に失敗しました。しばらく経ってから再度お試しください。';
                submissionMessageElement.style.display = 'none';
            });
        }
    </script>
</body>
</html>
